<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Kickstart text classification with GPT-3, part 3</title><style>html body{font-family:source sans pro,sans-serif;background-color:#fff;font-weight:200}:root{--accent:#9c27b0;--border-width:5px}</style><link rel=stylesheet href=https://antopolskiy.github.io/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source%20Sans%20Pro"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/json.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/toml.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/html.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/css.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/sql.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/cpp.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/c.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/makefile.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/nginx.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/shell.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/xml.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/rust.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/powershell.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/ruby.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/perl.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/lua.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/matlab.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scheme.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/clojure.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/erlang.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/elixir.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/fortran.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/lisp.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/pascal.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/prolog.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/vhdl.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/verilog.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/coffeescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/diff.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/django.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/jinja.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/latex.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/markdown.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/nginx.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/nginxconf.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/protobuf.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/toml.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/vim.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/x86asm.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script><script>hljs.initHighlightingOnLoad()</script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script>$(document).on("click",function(){$(".collapse").collapse("hide")})</script><meta name=generator content="Hugo 0.124.1"><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>Kickstart text classification with GPT-3, part 3</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/>Home</a></li><li><a href=/post/>Posts</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=mailto:s.antopolsky@gmail.com><i class="fas fa-envelope"></i></a></li><li class=navbar-icon><a href=https://github.com/antopolskiy/><i class="fab fa-github"></i></a></li><li class=navbar-icon><a href=https://twitter.com/antopolskiy/><i class="fab fa-twitter"></i></a></li><li class=navbar-icon><a href=https://www.linkedin.com/in/antop/><i class="fab fa-linkedin"></i></a></li><li class=navbar-icon><a href=https://stackoverflow.com/users/3033945/sergey-antopolskiy><i class="fab fa-stack-overflow"></i></a></li></ul></div></div></nav><main><div class=content><h2>Kickstart text classification with GPT-3, part 3</h2><h5>Pubished: November 20, 2022</h5><a href=https://antopolskiy.github.io/tags/ml><kbd class=item-tag>ml</kbd></a>
<a href=https://antopolskiy.github.io/tags/nlp><kbd class=item-tag>nlp</kbd></a>
<a href=https://antopolskiy.github.io/tags/gpt3><kbd class=item-tag>gpt3</kbd></a></div><div align=start class=content><h1 id=into>Into</h1><p>In the <a href=https://antopolskiy.github.io/post/gpt3_2/>previous part</a> we created a table-based prompt and got the completion in the form of TRUE / FALSE values for each of our samples and labels. In this post, we will automate this process.</p><h1 id=whats-an-api>What&rsquo;s an API?</h1><p>API (Application Programming Interface) is a developer-friendly way to communicate programmatically with a particular service / application. APIs are usually used to automate actions and integrate services. API is the opposite of a visual GUI (Guided User Interface), which is what we normally use. In the previous posts, we&rsquo;ve used GUI of GPT-3, but it also has an API which we will use now.</p><h1 id=setting-up-gpt-3-api>Setting up GPT-3 API</h1><p>For Python, there is a dedicated package <code>openai</code> which simplifies API calls, but there is also a way to <a href=https://beta.openai.com/docs/api-reference/making-requests>make requests with a URL</a>, which will work in any language capable of making HTTP requests.</p><p>First, install <code>openai</code> Python package:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install openai
</span></span></code></pre></div><p>Then, obtain your API key. Go to <a href=https://beta.openai.com/account/api-keys>https://beta.openai.com/account/api-keys</a> and click &ldquo;+ Create new secret key&rdquo;. Copy the value which appeared on the screen (e.g. in my case it starts with <code>sk-neOy3i0r...</code>) and make sure to never expose it on the Internet. For example, do not commit scripts or notebooks containing this key, as anyone who has it will be able to use funds on your account.</p><p>In your Python script or notebook, import <code>openai</code> and specify the <code>api_key</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#998;font-style:italic># import openapi SDK</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>openai</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># paste the API key here</span>
</span></span><span style=display:flex><span>openai<span style=color:#000;font-weight:700>.</span>api_key <span style=color:#000;font-weight:700>=</span> <span style=color:#d14>&#34;sk-neOy3i0r...&#34;</span>
</span></span></code></pre></div><h1 id=making-a-test-request>Making a test request</h1><p>Set the parameters for a test request. We limit <code>max_tokens</code> to 10, and set <code>temperature</code> to 0, which is better for classification tasks. If you want to know more about the parameters, take a look at the <a href=https://beta.openai.com/docs/api-reference/completions/create>API documentation</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#998;font-style:italic># prepare dictionary with the parameters</span>
</span></span><span style=display:flex><span>params <span style=color:#000;font-weight:700>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#d14>&#34;prompt&#34;</span>: <span style=color:#d14>&#34;test&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#d14>&#34;engine&#34;</span>: <span style=color:#d14>&#34;text-davinci-002&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#d14>&#34;max_tokens&#34;</span>: <span style=color:#099>10</span>,
</span></span><span style=display:flex><span>    <span style=color:#d14>&#34;temperature&#34;</span>: <span style=color:#099>0</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Finally, request GPT-3 completion:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#998;font-style:italic># get completion response</span>
</span></span><span style=display:flex><span>response <span style=color:#000;font-weight:700>=</span> openai<span style=color:#000;font-weight:700>.</span>Completion<span style=color:#000;font-weight:700>.</span>create(<span style=color:#000;font-weight:700>**</span>params)
</span></span><span style=display:flex><span>response <span style=color:#000;font-weight:700>=</span> response<span style=color:#000;font-weight:700>.</span>to_dict_recursive()
</span></span></code></pre></div><p>If everything worked fine, the <code>response</code> should be something like<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>{<span style=color:#d14>&#39;id&#39;</span>: <span style=color:#d14>&#39;cmpl-6BhAmdV1eevida1MWsIklSTB6kven&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#d14>&#39;object&#39;</span>: <span style=color:#d14>&#39;text_completion&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#d14>&#39;created&#39;</span>: <span style=color:#099>1668245584</span>,
</span></span><span style=display:flex><span> <span style=color:#d14>&#39;model&#39;</span>: <span style=color:#d14>&#39;text-davinci-002&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#d14>&#39;choices&#39;</span>: [{<span style=color:#d14>&#39;text&#39;</span>: <span style=color:#d14>&#39;_split(X, y, test_size&#39;</span>,
</span></span><span style=display:flex><span>   <span style=color:#d14>&#39;index&#39;</span>: <span style=color:#099>0</span>,
</span></span><span style=display:flex><span>   <span style=color:#d14>&#39;logprobs&#39;</span>: <span style=color:#000;font-weight:700>None</span>,
</span></span><span style=display:flex><span>   <span style=color:#d14>&#39;finish_reason&#39;</span>: <span style=color:#d14>&#39;length&#39;</span>}],
</span></span><span style=display:flex><span> <span style=color:#d14>&#39;usage&#39;</span>: {<span style=color:#d14>&#39;prompt_tokens&#39;</span>: <span style=color:#099>1</span>, <span style=color:#d14>&#39;completion_tokens&#39;</span>: <span style=color:#099>10</span>, <span style=color:#d14>&#39;total_tokens&#39;</span>: <span style=color:#099>11</span>}}
</span></span></code></pre></div><p>Let&rsquo;s see what we&rsquo;ve got here. The important bit is <code>response["choices"][0]["text"]</code>, which in my case equals to <code>'_split(X, y, test_size'</code><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. This is our completion. It is what we saw highlighted green in the GPT-3 GUI.</p><h1 id=getting-the-completion-for-a-real-prompt>Getting the completion for a real prompt</h1><p>Now we can obtain the completion for our real task:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>params <span style=color:#000;font-weight:700>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#d14>&#34;prompt&#34;</span>: <span style=color:#d14>&#34;&#34;&#34;# List of games
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14>name: DOOM
</span></span></span><span style=display:flex><span><span style=color:#d14>description: Now includes all three premium DLC packs (Unto the Evil, Hell Followed, and Bloodfall), maps, modes, and weapons, as well as all feature updates including Arcade Mode, Photo Mode, and the latest Update 6.66, which brings further multiplayer improvements as well as revamps multiplayer progression.
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14>name: This War of Mine
</span></span></span><span style=display:flex><span><span style=color:#d14>description: In This War Of Mine you do not play as an elite soldier, rather a group of civilians trying to survive in a besieged city; struggling with lack of food, medicine and constant danger from snipers and hostile scavengers. The game provides an experience of war seen from an entirely new angle.
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14>name: Divinity: Original Sin 2 - Definitive Edition
</span></span></span><span style=display:flex><span><span style=color:#d14>description: The eagerly anticipated sequel to the award-winning RPG. Gather your party. Master deep, tactical combat. Join up to 3 other players - but know that only one of you will have the chance to become a God.
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14>name: Portal
</span></span></span><span style=display:flex><span><span style=color:#d14>description: Portal™ is a new single player game from Valve. Set in the mysterious Aperture Science Laboratories, Portal has been called one of the most innovative new games on the horizon and will offer gamers hours of unique gameplay.
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14>name: AdVenture Capitalist
</span></span></span><span style=display:flex><span><span style=color:#d14>description: Welcome, eager young investor, to AdVenture Capitalist! Arguably the world&#39;s greatest Capitalism simulator!
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14># Table of games and their genres (TRUE or FALSE)
</span></span></span><span style=display:flex><span><span style=color:#d14>
</span></span></span><span style=display:flex><span><span style=color:#d14>| name | genre_action | genre_rpg | genre_strategy | genre_simulation | genre_puzzle | genre_casual | genre_adventure | genre_platformer |
</span></span></span><span style=display:flex><span><span style=color:#d14>| --- | --- | --- | --- | --- | --- | --- | --- | --- |&#34;&#34;&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#d14>&#34;engine&#34;</span>: <span style=color:#d14>&#34;text-davinci-002&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#d14>&#34;max_tokens&#34;</span>: <span style=color:#099>200</span>,
</span></span><span style=display:flex><span>    <span style=color:#d14>&#34;temperature&#34;</span>: <span style=color:#099>0</span>,
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>response <span style=color:#000;font-weight:700>=</span> openai<span style=color:#000;font-weight:700>.</span>Completion<span style=color:#000;font-weight:700>.</span>create(<span style=color:#000;font-weight:700>**</span>params)
</span></span><span style=display:flex><span>response <span style=color:#000;font-weight:700>=</span> response<span style=color:#000;font-weight:700>.</span>to_dict_recursive()
</span></span></code></pre></div><p>And I get this as a response:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>{<span style=color:#d14>&#39;id&#39;</span>: <span style=color:#d14>&#39;cmpl-6Bh7ouHD97KKO8eoauancd8eVCpcW&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#d14>&#39;object&#39;</span>: <span style=color:#d14>&#39;text_completion&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#d14>&#39;created&#39;</span>: <span style=color:#099>1668245400</span>,
</span></span><span style=display:flex><span> <span style=color:#d14>&#39;model&#39;</span>: <span style=color:#d14>&#39;text-davinci-002&#39;</span>,
</span></span><span style=display:flex><span> <span style=color:#d14>&#39;choices&#39;</span>: [{<span style=color:#d14>&#39;text&#39;</span>: <span style=color:#d14>&#39;</span><span style=color:#d14>\n</span><span style=color:#d14>| DOOM | TRUE | FALSE | FALSE | FALSE | FALSE | FALSE | FALSE | FALSE |</span><span style=color:#d14>\n</span><span style=color:#d14>| This War of Mine | FALSE | FALSE | FALSE | TRUE | FALSE | FALSE | TRUE | FALSE |</span><span style=color:#d14>\n</span><span style=color:#d14>| Divinity: Original Sin 2 - Definitive Edition | FALSE | TRUE | TRUE | FALSE | FALSE | FALSE | FALSE | FALSE |</span><span style=color:#d14>\n</span><span style=color:#d14>| Portal | FALSE | FALSE | FALSE | FALSE | TRUE | FALSE | FALSE | FALSE |</span><span style=color:#d14>\n</span><span style=color:#d14>| AdVenture Capitalist | FALSE | FALSE | FALSE | TRUE | FALSE | TRUE | FALSE | FALSE |&#39;</span>,
</span></span><span style=display:flex><span>   <span style=color:#d14>&#39;index&#39;</span>: <span style=color:#099>0</span>,
</span></span><span style=display:flex><span>   <span style=color:#d14>&#39;logprobs&#39;</span>: <span style=color:#000;font-weight:700>None</span>,
</span></span><span style=display:flex><span>   <span style=color:#d14>&#39;finish_reason&#39;</span>: <span style=color:#d14>&#39;stop&#39;</span>}],
</span></span><span style=display:flex><span> <span style=color:#d14>&#39;usage&#39;</span>: {<span style=color:#d14>&#39;prompt_tokens&#39;</span>: <span style=color:#099>369</span>,
</span></span><span style=display:flex><span>  <span style=color:#d14>&#39;completion_tokens&#39;</span>: <span style=color:#099>115</span>,
</span></span><span style=display:flex><span>  <span style=color:#d14>&#39;total_tokens&#39;</span>: <span style=color:#099>484</span>}}
</span></span></code></pre></div><h1 id=parsing-the-completion>Parsing the completion</h1><p>Now I need to parse the result to obtain labels for each of the games and genres. Instead of writing some kind of parsing loop, I will use a little trick and pretend that our table is a CSV-like object and use <code>pandas.read_csv()</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000;font-weight:700>from</span> <span style=color:#555>io</span> <span style=color:#000;font-weight:700>import</span> StringIO
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>import</span> <span style=color:#555>pandas</span> <span style=color:#000;font-weight:700>as</span> <span style=color:#555>pd</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># create a string buffer, which allow to pretend that a string comes from a file</span>
</span></span><span style=display:flex><span>s <span style=color:#000;font-weight:700>=</span> StringIO(<span style=color:#d14>&#34;| name | genre_action | genre_rpg | genre_strategy | genre_simulation | genre_puzzle | genre_casual | genre_adventure | genre_platformer |&#34;</span> <span style=color:#000;font-weight:700>+</span> response[<span style=color:#d14>&#34;choices&#34;</span>][<span style=color:#099>0</span>][<span style=color:#d14>&#34;text&#34;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># parse the string as a CSV with separator = &#34;|&#34;</span>
</span></span><span style=display:flex><span>df <span style=color:#000;font-weight:700>=</span> pd<span style=color:#000;font-weight:700>.</span>read_csv(s, sep<span style=color:#000;font-weight:700>=</span><span style=color:#d14>&#34;|&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># discard first and last columns, as they are empty</span>
</span></span><span style=display:flex><span>df <span style=color:#000;font-weight:700>=</span> df<span style=color:#000;font-weight:700>.</span>iloc[:, <span style=color:#099>1</span>:<span style=color:#000;font-weight:700>-</span><span style=color:#099>1</span>]
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># remove spaces around column names</span>
</span></span><span style=display:flex><span>df<span style=color:#000;font-weight:700>.</span>columns <span style=color:#000;font-weight:700>=</span> [c<span style=color:#000;font-weight:700>.</span>strip() <span style=color:#000;font-weight:700>for</span> c <span style=color:#000;font-weight:700>in</span> df<span style=color:#000;font-weight:700>.</span>columns]
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># remove spaces around values in the table</span>
</span></span><span style=display:flex><span>df <span style=color:#000;font-weight:700>=</span> df<span style=color:#000;font-weight:700>.</span>applymap(<span style=color:#000;font-weight:700>lambda</span> x: x<span style=color:#000;font-weight:700>.</span>strip())
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># map values TRUE and FALSE from string to bool</span>
</span></span><span style=display:flex><span>mapper <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>lambda</span> x: {<span style=color:#d14>&#34;TRUE&#34;</span>: <span style=color:#000;font-weight:700>True</span>, <span style=color:#d14>&#34;FALSE&#34;</span>: <span style=color:#000;font-weight:700>False</span>}<span style=color:#000;font-weight:700>.</span>get(x, x)
</span></span><span style=display:flex><span>df <span style=color:#000;font-weight:700>=</span> df<span style=color:#000;font-weight:700>.</span>applymap(mapper)
</span></span></code></pre></div><p>If everything worked well, we get a nice table like this:</p><p><img src=/true_false_table_example.png alt="Example table"></p><p>Now you can write automation code to request GPT-3 completion in a loop for many games, and concatenate the resulting tables to obtain a labelled dataset.</p><h1 id=whats-next>What&rsquo;s next</h1><p>In the next post, we will go 1 step deeper and obtain not only labels but also the probability of each label. This will give us a better idea of how confident GPT-3 is in its predictions and can be used to filter out low-confidence predictions.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>If it didn&rsquo;t work, let me know in the comments, and I can help you troubleshoot the issue.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Which is ironically also seems to be a bit of Python code, completely by accident. Yours can be different, because no one guarantees that GPT-3 is exactly the same at the time you are using it.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><h4 class=page-header>Related</h4><div class=item><h4><a href=/post/gpt3_4/>Kickstart text classification with GPT-3, part 4</a></h4><h5>January 7, 2023</h5><a href=https://antopolskiy.github.io/tags/ml><kbd class=item-tag>ml</kbd></a>
<a href=https://antopolskiy.github.io/tags/nlp><kbd class=item-tag>nlp</kbd></a>
<a href=https://antopolskiy.github.io/tags/gpt3><kbd class=item-tag>gpt3</kbd></a></div><div class=item><h4><a href=/post/gpt3_2/>Kickstart text classification with GPT-3, part 2</a></h4><h5>October 22, 2022</h5><a href=https://antopolskiy.github.io/tags/ml><kbd class=item-tag>ml</kbd></a>
<a href=https://antopolskiy.github.io/tags/nlp><kbd class=item-tag>nlp</kbd></a>
<a href=https://antopolskiy.github.io/tags/gpt3><kbd class=item-tag>gpt3</kbd></a></div><div class=item><h4><a href=/post/gpt3_1/>Kickstart text classification with GPT-3, part 1</a></h4><h5>October 1, 2022</h5><a href=https://antopolskiy.github.io/tags/ml><kbd class=item-tag>ml</kbd></a>
<a href=https://antopolskiy.github.io/tags/nlp><kbd class=item-tag>nlp</kbd></a>
<a href=https://antopolskiy.github.io/tags/gpt3><kbd class=item-tag>gpt3</kbd></a></div><h4 class=page-header>Comments</h4><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//https-antopolskiy-github-io.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></main><footer><p class="copyright text-muted">© Sergey Antopolskiy, 2024</p></footer></body></html>